#!/bin/bash
#
# postinstall script for patching IOAHCIBlockStorage in IOAHCIFamily
# enables TRIM support for non-Apple SSD drives in Mavericks 10.9.4 and later
#
# Copyright (C) tonymacx86 LLC

perl -pi -e 's|(^\x00{1,20})[^\x00]{9}(\x00{1,20}\x54)|$1\x00\x00\x00\x00\x00\x00\x00\x00\x00$2|sg' "${1}/System/Library/Extensions/IOAHCIFamily.kext/Contents/PlugIns/IOAHCIBlockStorage.kext/Contents/MacOS/IOAHCIBlockStorage"

touch "${1}/System/Library/Extensions/"

exit 0
